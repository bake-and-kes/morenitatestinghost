
<!doctypehtml>
<html lang="es">
   <meta charset="UTF-8">
   <meta content="width=device-width,initial-scale=1"name="viewport">
   <title>Finalizar Compra</title>
   <link href="img/logo.png"rel="icon"type="image/png">
<style>
  
/* Reset y configuración base */
* {
    box-sizing: border-box;
}

html, body { 
    overflow-x: hidden; 
    background-color: #ffffff; 
    position: relative; 
    touch-action: manipulation; 
    margin: 0;
    padding: 0;
} 

body { 
    background-color: #fff; 
    margin: 0; 
    padding: 20px; 
    font-family: Arial, sans-serif; 
    line-height: 1.6;
} 

/* Contenedor principal mejorado */
.checkout-container { 
    max-width: 1200px; 
    margin: 0 auto; 
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px; 
    align-items: start;
} 

/* Secciones principales */
.checkout-resumen, .checkout-datos { 
    background: white; 
    border-radius: 15px; 
    padding: 30px; 
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1); 
    border: 1px solid #f0f0f0;
} 

/* Items del checkout */
.checkout-item { 
    display: flex; 
    align-items: center; 
    padding: 20px 0; 
    border-bottom: 1px solid #f5f5f5; 
    gap: 15px;
} 

.checkout-item-img { 
    width: 70px; 
    height: 70px; 
    border-radius: 12px; 
    overflow: hidden; 
    flex-shrink: 0;
} 

.checkout-item-img img { 
    width: 100%; 
    height: 100%; 
    object-fit: cover; 
} 

.checkout-item-details { 
    flex: 1; 
    min-width: 0;
} 

.checkout-item-name { 
    font-weight: 600; 
    color: #333; 
    margin-bottom: 5px;
    font-size: 16px;
} 

.checkout-item-price { 
    color: #666; 
    font-size: 14px; 
} 

.checkout-item-total { 
    font-weight: bold; 
    color: #c5a8a3; 
    font-size: 18px;
    text-align: right;
    min-width: 80px;
} 

/* Botones de eliminar */
.eliminar-item-btn {
    background: #ff4757;
    color: white;
    border: none;
    border-radius: 50%;
    width: 32px;
    height: 32px;
    cursor: pointer;
    font-size: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    flex-shrink: 0;
}

.eliminar-item-btn:hover {
    background: #ff6b81;
    transform: scale(1.1);
}

#eliminar-todo, #eliminar-adiciones {
    background: #ff4757;
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 500;
    margin: 10px 0;
    width: 100%;
}

#eliminar-todo:hover, #eliminar-adiciones:hover {
    background: #ff6b81;
    transform: translateY(-2px);
}

/* Totales del checkout */
.checkout-total { 
    margin-top: 30px; 
    padding-top: 25px; 
    border-top: 2px solid #f0f0f0; 
} 

.checkout-total-row { 
    display: flex; 
    justify-content: space-between; 
    margin-bottom: 12px; 
    color: #666; 
    font-size: 16px;
} 

.checkout-total-final { 
    display: flex; 
    justify-content: space-between; 
    margin-top: 20px; 
    font-size: 22px; 
    font-weight: bold; 
    color: #c5a8a3; 
    padding-top: 15px;
    border-top: 2px solid #c5a8a3;
} 

/* Formularios mejorados */
.form-group { 
    margin-bottom: 25px; 
    width: 100%;
    position: relative;
} 

.form-group label { 
    display: block; 
    margin-bottom: 8px; 
    color: #333; 
    font-weight: 600; 
    font-size: 15px;
} 

/* ESTILOS MEJORADOS PARA SELECTS */
.form-group select,
.globos-select,
#motivo,
#mensaje-predefinido,
#metodo-pago,
#globos-helio {
    width: 100%; 
    padding: 15px; 
    border: 2px solid #e0e0e0; 
    border-radius: 10px; 
    font-size: 16px; 
    transition: all 0.3s ease;
    background: #fafafa;
    cursor: pointer;
    
    /* CUSTOM DROPDOWN ARROW */
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    background-image: url("data:image/svg+xml;charset=US-ASCII,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 4 5'><path fill='%23666' d='M2,0L0,2h4zm0,5L0,3h4z'/></svg>");
    background-repeat: no-repeat;
    background-position: right 15px center;
    background-size: 12px;
    padding-right: 45px;
    
    /* FORZAR QUE EL DROPDOWN SALGA ABAJO */
    position: relative;
    z-index: 1;
}

/* HOVER Y FOCUS STATES */
.form-group select:hover,
.globos-select:hover {
    border-color: #c5a8a3;
    background: white;
    box-shadow: 0 2px 8px rgba(197, 168, 163, 0.1);
}

.form-group select:focus,
.globos-select:focus {
    border-color: #c5a8a3;
    background: white;
    outline: none;
    box-shadow: 0 4px 12px rgba(197, 168, 163, 0.2);
    z-index: 999; /* PRIORIDAD MÁXIMA AL ABRIR */
}

/* OPCIONES DEL SELECT */
.form-group select option,
.globos-select option {
    padding: 12px;
    background: white;
    color: #333;
    font-size: 16px;
    border: none;
    margin: 0;
}

.form-group select option:hover,
.globos-select option:hover {
    background: #f8f4f4;
    color: #c5a8a3;
}

.form-group select option:checked,
.globos-select option:checked {
    background: #c5a8a3;
    color: white;
    font-weight: 600;
}

/* INPUTS Y TEXTAREAS REGULARES */
.form-group input, 
.form-group textarea { 
    width: 100%; 
    padding: 15px; 
    border: 2px solid #e0e0e0; 
    border-radius: 10px; 
    font-size: 16px; 
    transition: all 0.3s ease;
    background: #fafafa;
} 

.form-group input:focus, 
.form-group textarea:focus { 
    border-color: #c5a8a3; 
    background: white;
    outline: none;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(197, 168, 163, 0.2);
} 

/* Botón principal */
.btn-enviar { 
    background: linear-gradient(135deg, #c5a8a3 0%, #b39690 100%); 
    color: white; 
    border: none; 
    padding: 18px 30px; 
    border-radius: 12px; 
    font-size: 18px; 
    font-weight: 600;
    cursor: pointer; 
    width: 100%; 
    margin-top: 30px; 
    transition: all 0.3s ease; 
    text-transform: uppercase;
    letter-spacing: 1px;
} 

.btn-enviar:hover { 
    background: linear-gradient(135deg, #b39690 0%, #a08680 100%); 
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(197, 168, 163, 0.4);
} 

/* Carrito vacío */
.carrito-vacio { 
    text-align: center; 
    padding: 60px 20px; 
    color: #666; 
} 

.carrito-vacio i { 
    font-size: 80px; 
    color: #f5f5f5; 
    margin-bottom: 25px; 
    display: block; 
} 

/* Procesando pedido */
.procesando-pedido { 
    text-align: center; 
    padding: 40px 20px; 
} 

/* Notificaciones */
.toast-notification { 
    position: fixed; 
    bottom: 30px; 
    right: 30px; 
    background: #4CAF50; 
    color: white; 
    padding: 20px 30px; 
    border-radius: 12px; 
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2); 
    z-index: 1002; 
    animation: slideIn 0.4s ease-out forwards; 
    font-weight: 500;
} 

@keyframes slideIn { 
    from { 
        transform: translateX(100%); 
        opacity: 0; 
    } 
    to { 
        transform: translateX(0); 
        opacity: 1; 
    } 
} 

.header { 
    margin-bottom: 30px; 
    text-align: center; 
} 

.header h1 { 
    color: #c5a8a3; 
    margin-bottom: 10px; 
} 

.header .pasos { 
    display: flex; 
    justify-content: center; 
    margin-top: 20px; 
} 

.header .paso { 
    display: flex; 
    align-items: center; 
    margin: 0 15px; 
    color: #999; 
    font-weight: 500; 
} 

.header .paso.activo { 
    color: #c5a8a3; 
    font-weight: bold; 
} 

.header .paso-numero { 
    width: 30px; 
    height: 30px; 
    border-radius: 50%; 
    background: #f5f5f5; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    margin-right: 10px; 
} 

.header .paso.activo .paso-numero { 
    background: #c5a8a3; 
    color: white; 
} 

@media (max-width: 768px) { 
    .header .pasos { 
        flex-direction: column; 
        align-items: flex-start; 
        padding-left: 10px;
    } 
    .header .paso { 
        margin: 5px 0; 
    } 
}

/* Opciones adicionales */
.extra-options { 
    margin-top: 30px; 
    padding: 25px; 
    background: linear-gradient(135deg, #faf4f4 0%, #f8f2f2 100%); 
    border-radius: 15px; 
    border: 1px solid #e8d8d8;
} 

.extra-options h3 {
    margin-bottom: 20px;
    color: #333;
    font-size: 20px;
    text-align: center;
    font-weight: 600;
}

/* Modales mejorados */
.modal, .modal-1 { 
    display: none; 
    position: fixed; 
    z-index: 1000; 
    left: 0; 
    top: 0; 
    width: 100%; 
    height: 100%; 
    background-color: rgba(0, 0, 0, 0.6); 
    overflow: auto; 
    backdrop-filter: blur(5px);
} 

.modal-content, .modal-content-1 { 
    background-color: #fff; 
    margin: 5% auto; 
    padding: 30px; 
    border: none; 
    width: 90%; 
    max-width: 600px; 
    max-height: 85vh; 
    border-radius: 20px; 
    position: relative; 
    overflow-y: auto; 
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    animation: modalAppear 0.3s ease-out forwards;
} 

@keyframes modalAppear {
    from {
        transform: translateY(-50px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

/* Scrollbar personalizado */
.modal-content::-webkit-scrollbar, 
.modal-content-1::-webkit-scrollbar { 
    width: 8px; 
} 

.modal-content::-webkit-scrollbar-track, 
.modal-content-1::-webkit-scrollbar-track { 
    background: #f1f1f1; 
    border-radius: 10px; 
} 

.modal-content::-webkit-scrollbar-thumb, 
.modal-content-1::-webkit-scrollbar-thumb { 
    background: #c5a8a3; 
    border-radius: 10px; 
} 

.modal-content::-webkit-scrollbar-thumb:hover, 
.modal-content-1::-webkit-scrollbar-thumb:hover { 
    background: #b29792; 
} 

/* Items de adición */
.adicion-item { 
    display: flex; 
    align-items: center; 
    margin-bottom: 20px; 
    border-bottom: 1px solid #eee; 
    padding-bottom: 20px; 
    gap: 20px;
} 

.adicion-item img { 
    width: 100px; 
    height: 100px; 
    border-radius: 12px; 
    object-fit: cover;
    flex-shrink: 0;
} 

.adicion-info { 
    flex: 1; 
} 

.adicion-info h3 { 
    margin: 0 0 8px 0; 
    font-size: 18px; 
    font-weight: 600;
} 

.adicion-info p { 
    margin: 0; 
    color: #666; 
    font-size: 14px;
} 

.adicion-item button { 
    background: linear-gradient(135deg, #c5a8a3 0%, #b39690 100%); 
    color: #fff; 
    border: none; 
    padding: 12px 20px; 
    border-radius: 8px; 
    cursor: pointer; 
    font-weight: 500;
    transition: all 0.3s ease;
} 

.adicion-item button:hover { 
    background: linear-gradient(135deg, #b39690 0%, #a08680 100%); 
    transform: translateY(-2px);
} 

/* Botones de cerrar */
.close, .close-1 { 
    color: #aaa; 
    float: right; 
    font-size: 32px; 
    font-weight: bold; 
    cursor: pointer; 
    line-height: 1;
    transition: all 0.3s ease;
} 

.close:hover, .close-1:hover { 
    color: #c5a8a3; 
    transform: scale(1.1);
} 

/* Globos en modal */
.globos-imagenes-1 { 
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap: 15px; 
    padding: 20px; 
    max-height: 300px;
    overflow-y: auto;
} 

.globos-imagenes-1 img { 
    width: 100%; 
    height: 100px; 
    border-radius: 12px; 
    object-fit: contain; 
    cursor: pointer; 
    border: 3px solid transparent; 
    transition: all 0.3s ease; 
    padding: 8px; 
    background: #f9f9f9;
} 

.globos-imagenes-1 img.seleccionado { 
    border: 3px solid #c5a8a3; 
    transform: scale(1.05); 
    box-shadow: 0 8px 25px rgba(197, 168, 163, 0.4); 
    background: white;
} 

.globos-imagenes-1 img:hover {
    transform: scale(1.02);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

/* Botones de acción */
#agregar-adicion, 
#ver-colores-globos, 
#seleccionar-globo { 
    background: linear-gradient(135deg, #c5a8a3 0%, #b39690 100%); 
    color: white; 
    border: none; 
    padding: 15px 25px; 
    border-radius: 10px; 
    font-size: 16px; 
    font-weight: 600;
    cursor: pointer; 
    transition: all 0.3s ease; 
    margin: 10px 0; 
    width: 100%;
} 

#agregar-adicion:hover, 
#ver-colores-globos:hover, 
#seleccionar-globo:hover { 
    background: linear-gradient(135deg, #b39690 0%, #a08680 100%); 
    transform: translateY(-2px); 
    box-shadow: 0 8px 25px rgba(197, 168, 163, 0.4);
} 

/* Información de precios */
.precio-info-1 {
    background: white;
    border-radius: 12px;
}

.precio-info-1 p {
    margin: 8px 0;
    font-weight: 500;
    color: #333;
}

/* Resumen para imprimir */
#resumen-para-imprimir { 
    width: 100%; 
    max-width: 600px; 
    margin: 20px auto; 
    padding: 30px; 
    background: white; 
    border-radius: 15px; 
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1); 
} 

.download-btn { 
    background: #4CAF50; 
    color: white; 
    border: none; 
    padding: 15px 25px; 
    border-radius: 10px; 
    font-size: 16px; 
    font-weight: 500;
    cursor: pointer; 
    margin-top: 20px; 
    transition: all 0.3s ease; 
    width: 100%;
} 

.download-btn:hover { 
    background: #3e8e41; 
    transform: translateY(-2px);
} 

/* Responsive Design */
@media (max-width: 1024px) {
    .checkout-container {
        grid-template-columns: 1fr;
        max-width: 800px;
    }
}

@media (max-width: 768px) { 
    body {
        padding: 10px;
    }
    
    .checkout-container { 
        grid-template-columns: 1fr;
        gap: 15px;
    } 
    
    .checkout-resumen, .checkout-datos {
        padding: 15px;
    }
    
    .header h1 {
        font-size: 1.8rem;
    }
    
    
    /* CHECKOUT ITEMS ARREGLADOS PARA MÓVIL */
    .checkout-item {
        display: flex;
        flex-direction: row !important; /* FORZAR FILA */
        align-items: center;
        padding: 15px 0;
        gap: 12px;
        text-align: left; /* NO CENTRADO */
    }
    
    .checkout-item-img {
        width: 60px;
        height: 60px;
        flex-shrink: 0;
    }
    
    .checkout-item-details {
        flex: 1;
        min-width: 0;
    }
    
    .checkout-item-name {
        font-size: 14px;
        line-height: 1.3;
    }
    
    .checkout-item-total {
        font-size: 16px;
        min-width: 70px;
    }
    
    /* ADICIONES ARREGLADAS PARA MÓVIL */
    .adicion-item {
        display: flex !important;
        flex-direction: row !important; /* FORZAR FILA */
        align-items: center;
        gap: 15px;
        text-align: left; /* NO CENTRADO */
        margin-bottom: 15px;
        padding-bottom: 15px;
    }
    
    .adicion-item img {
        width: 80px;
        height: 80px;
        flex-shrink: 0;
    }
    
    .adicion-info {
        flex: 1;
        min-width: 0;
    }
    
    .adicion-info h3 {
        font-size: 16px;
        margin-bottom: 5px;
    }
    
    .adicion-item button {
        flex-shrink: 0;
        padding: 8px 15px;
        font-size: 14px;
        width: auto; /* NO FULL WIDTH */
    }
    
    /* SELECTS Y FORMULARIOS ARREGLADOS */
    .form-group input, 
    .form-group select, 
    .form-group textarea,
    .globos-select {
        padding: 12px;
        font-size: 16px; /* iOS FIX */
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        background-repeat: no-repeat;
        background-position: right 12px center;
        background-size: 12px;
        padding-right: 35px;
    }
    
    /* MODAL RESPONSIVE */
    .modal-content, .modal-content-1 {
        width: 95%;
        margin: 5% auto;
        padding: 20px;
        max-height: 90vh;
    }
    
    /* GLOBOS EN MODAL MÓVIL */
    .globos-imagenes-1 {
        display: flex !important;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
        padding: 15px;
    }
    
    .globos-imagenes-1 img {
        width: 70px !important;
        height: 70px !important;
        flex-shrink: 0;
        object-fit: contain;
    }
    
    /* BOTONES EN MÓVIL */
    #agregar-adicion, 
    #ver-colores-globos, 
    #seleccionar-globo,
    #eliminar-adiciones {
        padding: 12px 20px;
        font-size: 14px;
        margin: 8px 0;
    }
} 

@media (max-width: 480px) {
    body {
        padding: 8px;
    }
    
    .checkout-resumen, .checkout-datos {
        padding: 12px;
    }
    
    .header h1 {
        font-size: 1.5rem;
    }
    
    .header .paso {
        font-size: 20px;
    }
    
    
    
    /* MÁS PEQUEÑO EN PANTALLAS MUY PEQUEÑAS */
    .checkout-item-img {
        width: 50px;
        height: 50px;
    }
    
    .adicion-item img {
        width: 70px;
        height: 70px;
    }
    
    .globos-imagenes-1 img {
        width: 60px !important;
        height: 60px !important;
    }
    
    .form-group input, 
    .form-group select, 
    .form-group textarea,
    .globos-select {
        padding: 10px;
        font-size: 16px; /* iOS NO ZOOM */
    }
}
 /* Estilos para los círculos de colores de lazo */
  .colores-lazo-container {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 10px;
  }
  
  .color-lazo-option {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid transparent;
    transition: all 0.2s ease;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  
  .color-lazo-option:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  }
  
  .color-lazo-option.seleccionado {
    border: 2px solid #333;
    box-shadow: 0 0 0 2px #c5a8a3;
  }

  </style>
   <link href="" rel="stylesheet">
  <div class="header">
  <h1>Finalizar Compra</h1>
  <div class="pasos">
    <div class="paso">
      <div class="paso-numero">1</div>
      <span>Carrito</span>
    </div>
    <div class="paso activo">
      <div class="paso-numero">2</div>
      <span>Detalles de Envío</span>
    </div>
    <div class="paso">
      <div class="paso-numero">3</div>
      <span>Confirmación</span>
    </div>
  </div>
</div>
<div class="checkout-container">
  <div class="checkout-resumen">
    <div id="checkout-items"></div>
    <div class="checkout-total" id="checkout-total">
      <div class="checkout-total-row"><span>Subtotal:</span> <span id="checkout-subtotal">$0</span></div>
      <div class="checkout-total-row"><span>Envío:</span> <span id="checkout-envio">$0</span></div>
      <div class="checkout-total-final"><span>Total:</span> <span id="checkout-total-valor">$0</span></div>
    </div>
  </div>
  <div class="checkout-datos">
    <h2>Datos de Envío</h2>
    <form id="checkout-form">
      <div class="form-group"><label for="nombre">Nombre completo *</label> <input id="nombre" required></div>
      <div class="form-group"><label for="email">Correo electrónico *</label> <input id="email" required type="email"></div>
      <div class="form-group"><label for="telefono">Teléfono</label> <input id="telefono" type="tel"></div>
      
      <!-- Nuevo campo: Selector de fecha -->
      <div class="form-group">
        <label for="fecha-entrega">Fecha de entrega *</label>
        <input type="date" id="fecha-entrega" required min="">
      </div>
      
      <div class="form-group"><label for="direccion">Dirección de envío *</label> 
        <input type="text" id="direccion" required> <!-- Cambiado de textarea a input -->
      </div>
      
      <!-- Nuevo campo: Punto de referencia -->
      <div class="form-group">
        <label for="punto-referencia">Punto de referencia</label>
        <input type="text" id="punto-referencia" placeholder="Ej: Frente al parque, casa verde">
      </div>
      
      <!-- Nuevos campos: Información del receptor -->
      <div class="form-group">
        <label for="receptor-nombre">Quién recibe (nombre completo) *</label>
        <input type="text" id="receptor-nombre" required>
      </div>
      
      <div class="form-group">
        <label for="receptor-celular">Número de celular del receptor *</label>
        <input type="tel" id="receptor-celular" required>
      </div>
      
      <div class="extra-options">
        <h3>Opciones adicionales</h3>
        
        <!-- Selector de motivo actualizado -->
        <div class="form-group">
          <label for="motivo">Mensaje de globo</label> 
          <select id="motivo">
            <option value="">Seleccionar mensaje</option>
            <option value="feliz-cumpleanos">Feliz cumpleaños</option>
            <option value="feliz-aniversario">Feliz aniversario</option>
            <option value="feliz-mes">Feliz mes</option>
            <option value="feliz-grado">Feliz grado</option>
            <option value="te-amo">Te amo</option>
            <option value="te-quiero">Te quiero</option>
            <option value="felicidades">Felicidades</option>
            <option value="bienvenido">Bienvenido</option>
            <option value="personalizado">Mensaje personalizado (+$3.000)</option>
          </select>
        </div>
        
        <div class="form-group" id="mensaje-personalizado-globo-container" style="display:none">
          <label for="mensaje-personalizado-globo">Mensaje personalizado (+$3.000)</label>
          <textarea id="mensaje-personalizado-globo" rows="2" placeholder="Escriba aquí su mensaje personalizado"></textarea>
        </div>
        
        <!-- Selector de colores de lazo (solo para desayunos) -->
        <div class="form-group" id="selector-lazo-container" style="display: none;">
          <label>Color del lazo</label>
          <div id="colores-lazo" class="colores-lazo-container"></div>
        </div>
        
        <br>
        <div class="form-group-1">
          <label for="globos-helio">Agregar globos</label>
          <p>Globo con helio látex: $4.500 c/u</p>
          <div class="globos-option-1">
            <select id="globos-helio" class="globos-select">
              <option value="0">0 globos</option>
              <option value="1">1 globo</option>
              <option value="2">2 globos</option>
              <option value="3">3 globos</option>
              <option value="4">4 globos</option>
              <option value="5">5 globos</option>
              <option value="6">6 globos</option>
              <option value="7">7 globos</option>
              <option value="8">8 globos</option>
              <option value="9">9 globos</option>
              <option value="10">10 globos</option>
              <option value="11">11 globos</option>
              <option value="12">12 globos</option>
              <option value="13">13 globos</option>
              <option value="14">14 globos</option>
              <option value="15">15 globos</option>
              <option value="personalizado">Cantidad personalizada</option>
            </select>

            <div id="cantidad-personalizada-container" style="display: none; margin-top: 10px;">
              <label for="cantidad-personalizada">Cantidad de globos:</label>
              <input type="number" id="cantidad-personalizada" min="1" value="1">
            </div>

            <br><br>
            <div class="precio-info-1" id="precio-globos">
            </div>
            <br>
            <button type="button" id="ver-colores-globos" style="display:none">Seleccionar colores y tipos de globos</button>
          </div>
        </div>
        
        <div class="modal-1" id="modal-globos-1">
          <div class="modal-content-1">
            <span class="close-1">×</span>
            <h2 style="font-family:'Brush Script MT',cursive;font-size:30px">Selecciona tus globos</h2>
            <p style="font-size:14px;color:#666;">Puedes seleccionar varios globos de diferentes tipos</p>
            <div class="globos-imagenes-1"></div>
            <button type="button" id="seleccionar-globo">Confirmar selección</button>
          </div>
        </div>
        
        <div class="form-group">
          <label for="mensaje-predefinido">Mensaje de tarjeta - estándar o personalizado - sin costo adicional</label> 
          <select id="mensaje-predefinido">
            <option value="">Seleccionar mensaje (opcional)</option>
            <option value="feliz-cumple">¡Feliz Cumpleaños!</option>
            <option value="te-quiero">Te quiero mucho</option>
            <option value="felicidades">¡Felicidades!</option>
            <option value="gracias">Gracias por todo</option>
            <option value="especial">Eres alguien especial</option>
            <option value="aniversario">¡Feliz Aniversario!</option>
            <option value="personalizado">Mensaje personalizado</option>
          </select>
        </div>
        
        <div class="form-group" id="mensaje-personalizado-container" style="display:none">
          <label for="mensaje-personalizado">Mensaje personalizado</label>
          <textarea id="mensaje-personalizado" rows="2" placeholder="Escriba aquí su mensaje personalizado"></textarea>
        </div>
      </div>
      
      <div class="modal" id="adicion-modal">
        <div class="modal-content">
          <span id="close-modal" class="close">×</span>
          <h2>Agregar Adición</h2>
          <div id="adiciones-container"></div>
        </div>
      </div>
      
      <button type="button" id="agregar-adicion">Agregar otra adición</button>
      <button type="button" id="eliminar-adiciones">Eliminar adiciones</button><br><br>
      
      <div class="form-group">
        <label for="metodo-pago">Método de pago</label> 
        <select id="metodo-pago" name="metodo-pago" required>
          <option value="">Selecciona método de pago</option>
          <option value="efectivo">Bancolombia</option>
          <option value="nequi">Nequi</option>
          <option value="daviplata">Daviplata</option>
          <option value="wester">Wester union</option>

        </select>
      </div>
      
      <button type="submit" class="btn-enviar">Finalizar Compra</button>
    </form>
  </div>
</div>

<div id="modal-adiciones" style="display:none">
  <div class="modal-content">
    <span class="close-modal">×</span>
    <h3>Selecciona una adición</h3>
    <div class="adiciones-list"></div>
  </div>
</div>

<div id="resumen-para-imprimir" style="display:none">
  <h2>Resumen del pedido</h2>
  <div id="resumen-items-print"></div>
  <div id="resumen-totales-print"></div>
  <div id="resumen-cliente-print"></div>
  <div id="resumen-adicionales-print"></div>
</div>

<div class="toast-notification" id="toastNotification" style="display:none"></div>

<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.2/html2canvas.min.js"></script>
<script src="js/auth.js"></script>
<script src="js/checkout-auth.js"></script>


 

<script>
// Inicialización de Firebase
if (!firebase.apps.length) {
  const firebaseConfig = {
    apiKey: "AIzaSyBoRNOrpueYTJVeqxZwMtUsyAYArEHvgVU",
    authDomain: "morenita0ficial.firebaseapp.com",
    databaseURL: "https://morenita0ficial-default-rtdb.firebaseio.com",
    projectId: "morenita0ficial",
    storageBucket: "morenita0ficial.firebasestorage.app",
    messagingSenderId: "867231481408",
    appId: "1:867231481408:web:50512d7709d3b9d4e7a9a5"
  };
  firebase.initializeApp(firebaseConfig);
}

const database = firebase.database();

let globosSeleccionados = [];
let colorLazoSeleccionado = null;
let categoriaProducto = "";

// Función para cargar colores de lazo desde Firebase
function cargarColoresLazo() {
  return new Promise((resolve, reject) => {
    database.ref('colores-lazos').once('value').then((snapshot) => {
      const colores = snapshot.val();
      resolve(colores);
    }).catch((error) => {
      reject(error);
    });
  });
}

// Función para mostrar los colores de lazo
function mostrarColoresLazo(colores) {
  const container = document.getElementById('colores-lazo');
  container.innerHTML = '';
  
  Object.keys(colores).forEach((key) => {
    const color = colores[key];
    const colorElement = document.createElement('div');
    colorElement.className = 'color-lazo-option';
    colorElement.style.backgroundColor = color.codigo;
    colorElement.setAttribute('data-color-id', key);
    colorElement.setAttribute('title', color.nombre);
    
    colorElement.addEventListener('click', function() {
      // Deseleccionar todos los colores
      document.querySelectorAll('.color-lazo-option').forEach(el => {
        el.classList.remove('seleccionado');
      });
      
      // Seleccionar este color
      this.classList.add('seleccionado');
      colorLazoSeleccionado = {
        id: key,
        nombre: color.nombre,
        codigo: color.codigo
      };
    });
    
    container.appendChild(colorElement);
  });
}

// Verificar si el producto es de categoría "desayunos" y mostrar selector de lazo
function verificarCategoriaProducto() {
  const carrito = JSON.parse(localStorage.getItem("carritoCheckout") || localStorage.getItem("carrito") || "[]");
  
  if (carrito && carrito.length > 0) {
    categoriaProducto = carrito[0].categoria || "";
    
    if (categoriaProducto.toLowerCase().includes("desayuno")) {
      document.getElementById('selector-lazo-container').style.display = 'block';
      
      // Cargar colores de lazo desde Firebase
      cargarColoresLazo().then(colores => {
        mostrarColoresLazo(colores);
      }).catch(error => {
        console.error("Error al cargar colores de lazo:", error);
      });
    } else {
      document.getElementById('selector-lazo-container').style.display = 'none';
    }
  }
}

// Configurar fecha mínima para el selector de fecha (hoy)
document.addEventListener("DOMContentLoaded", function() {
  const fechaInput = document.getElementById('fecha-entrega');
  if (fechaInput) {
    const hoy = new Date();
    const fechaMinima = hoy.toISOString().split('T')[0];
    fechaInput.min = fechaMinima;
  }
  
  // Verificar categoría del producto al cargar la página
  verificarCategoriaProducto();
});







// Función para mostrar productos en el checkout
function mostrarProductosCheckout(e) {
  const o = document.getElementById("checkout-items");
  let t = "<h3>Resumen del pedido</h3>";
  
  e.forEach((e, o) => {
    t += `
      <div class="checkout-item">
        <div class="checkout-item-img">
          <img src="${e.imagen}" alt="${e.nombre}">
        </div>
        <div class="checkout-item-details">
          <div class="checkout-item-name">${e.nombre}</div>
          <div class="checkout-item-price">$${e.precio} x ${e.cantidad}</div>
        </div>
        <div class="checkout-item-total">$${e.precio * e.cantidad}</div>
        <button class="eliminar-item-btn" data-item-id="${o}">×</button>
      </div>
    `;
  });
  
  o.innerHTML = t;
  
  // Agregar eventos a todos los botones de eliminar
  document.querySelectorAll(".eliminar-item-btn").forEach((e) => {
    e.addEventListener("click", function() {
      eliminarItem(parseInt(e.getAttribute("data-item-id")));
    });
  });
}

// Función para eliminar item del carrito
function eliminarItem(index) {
  let carritoCheckout = JSON.parse(localStorage.getItem("carritoCheckout") || "[]");
  let carritoPrincipal = JSON.parse(localStorage.getItem("carrito") || "[]");
  
  if (index >= 0 && index < carritoCheckout.length) {
    const itemEliminado = carritoCheckout[index];
    
    // 1. Eliminar del carrito checkout
    carritoCheckout.splice(index, 1);
    localStorage.setItem("carritoCheckout", JSON.stringify(carritoCheckout));
    
    // 2. Buscar y eliminar el mismo item del carrito principal
    carritoPrincipal = carritoPrincipal.filter(item => {
      return !(item.nombre === itemEliminado.nombre && 
              item.precio === itemEliminado.precio && 
              item.imagen === itemEliminado.imagen);
    });
    
    localStorage.setItem("carrito", JSON.stringify(carritoPrincipal));
    
    // Actualizar vistas
    mostrarProductosCheckout(carritoCheckout);
    calcularTotalesCheckout(carritoCheckout);
    mostrarNotificacion(`"${itemEliminado.nombre}" eliminado completamente`);
  }
}

// Función para calcular totales
function calcularTotalesCheckout(e) {
  const o = e.reduce(((e, o) => e + o.precio * o.cantidad), 0);
  const t = o > 0 ? 8000 : 0;
  
  // Calcular costo de globos
  let n = 0;
  const globosHelioSelect = document.getElementById("globos-helio");

  if (globosHelioSelect) {
    let cantidadGlobos = 0;
    
    if (globosHelioSelect.value === "personalizado") {
      const cantidadInput = document.getElementById("cantidad-personalizada");
      cantidadGlobos = parseInt(cantidadInput.value) || 0;
    } else {
      cantidadGlobos = parseInt(globosHelioSelect.value) || 0;
    }

    if (cantidadGlobos > 0) {
      // Usar los globos seleccionados de nuestra variable global
      let globosMetalizados = globosSeleccionados.filter(g => g.tipo === "metalizado").length;
      let globosLatex = globosSeleccionados.length - globosMetalizados;
      
      // Ajustar si hay más seleccionados que la cantidad permitida
      if (globosSeleccionados.length > cantidadGlobos) {
        const factor = cantidadGlobos / globosSeleccionados.length;
        globosMetalizados = Math.round(globosMetalizados * factor);
        globosLatex = cantidadGlobos - globosMetalizados;
      }
      
      n += (4500 * globosLatex) + (5000 * globosMetalizados);
    }
  }
  
  // Calcular costo de mensaje personalizado de tarjeta
  const i = document.getElementById("mensaje-predefinido");
  if (i && i.value === "personalizado") {
    n += 0;
  }
  
  // Calcular costo de mensaje personalizado de globo
  const motivo = document.getElementById("motivo");
  if (motivo && motivo.value === "personalizado") {
    n += 3000;
  }
  
  const c = o + t + n;
  
  document.getElementById("checkout-subtotal").textContent = `$${o}`;
  document.getElementById("checkout-envio").textContent = `$${t}`;
  
  const r = document.getElementById("checkout-total");
  const d = document.getElementById("adicionales-row");
  
  if (n > 0) {
    if (d) {
      d.querySelector("span:last-child").textContent = `$${n}`;
    } else {
      const e = document.createElement("div");
      e.id = "adicionales-row";
      e.className = "checkout-total-row";
      e.innerHTML = `
        <span>Adicionales:</span>
        <span>$${n}</span>
      `;
      const o = document.querySelector(".checkout-total-final");
      r.insertBefore(e, o);
    }
  } else {
    d && d.remove();
  }
  
  document.getElementById("checkout-total-valor").textContent = `$${c}`;
}

// Función para eliminar todas las adiciones
function eliminarTodasAdiciones() {
  const e = JSON.parse(localStorage.getItem("carritoCheckout") || localStorage.getItem("carrito") || "[]")
    .filter((e) => !e.nombre.startsWith("Adición"));
  
  localStorage.setItem("carritoCheckout", JSON.stringify(e));
  mostrarProductosCheckout(e);
  calcularTotalesCheckout(e);
  mostrarNotificacion("Todas las adiciones han sido eliminadas");
}

// Función para abrir modal de adiciones
async function abrirModalAdiciones() {
  try {
    const adiciones = await cargarAdiciones();
    const modal = document.getElementById("adicion-modal");
    const modalContent = modal.querySelector(".modal-content");
    
    // Limpiar contenido existente
    modalContent.innerHTML = `
      <span id="close-modal" class="close">×</span>
      <h2>Agregar Adición</h2>
      <div id="adiciones-container"></div>
    `;
    
    // Agregar cada adición al modal
    const container = document.getElementById("adiciones-container");
    Object.keys(adiciones).forEach((key) => {
      const adicion = adiciones[key];
      const adicionItem = document.createElement("div");
      adicionItem.className = "adicion-item";
      adicionItem.innerHTML = `
        <img alt="${adicion.nombre}" src="${adicion.imagen}">
        <div class="adicion-info">
          <h3>${adicion.nombre}</h3>
          <p>$${adicion.precio}</p>
          <p>${adicion.descripcion || ''}</p>
        </div>
        <button type="button" onclick='agregarAdicion("${adicion.nombre}", ${adicion.precio}, "${adicion.imagen}")'>Agregar</button>
      `;
      container.appendChild(adicionItem);
    });
    
    modal.style.display = "block";
    
    // Agregar evento para cerrar el modal
    document.getElementById("close-modal").addEventListener("click", cerrarModalAdiciones);
    
  } catch (error) {
    console.error("Error al cargar adiciones:", error);
    mostrarNotificacion("Error al cargar las opciones de adición");
  }
}

// Función para cerrar modal de adiciones
function cerrarModalAdiciones() {
  const e = document.getElementById("adicion-modal");
  e && (e.style.display = "none");
}

// Función para agregar adición
function agregarAdicion(e, o, t) {
  const n = localStorage.getItem("carritoCheckout") || localStorage.getItem("carrito");
  const a = n ? JSON.parse(n) : [];
  const i = {
    nombre: e,
    precio: o,
    imagen: t,
    cantidad: 1
  };
  a.push(i);
  localStorage.setItem("carritoCheckout", JSON.stringify(a));
  mostrarProductosCheckout(a);
  calcularTotalesCheckout(a);
  cerrarModalAdiciones();
  mostrarNotificacion(`Adición "${e}" agregada al carrito ($${o})`);
}

// Función para cargar adiciones desde Firebase
function cargarAdiciones() {
  return new Promise((resolve, reject) => {
    database.ref('adiciones').once('value').then((snapshot) => {
      const adiciones = snapshot.val();
      resolve(adiciones);
    }).catch((error) => {
      reject(error);
    });
  });
}

// Función para cargar globos desde Firebase
function cargarGlobos() {
  return new Promise((resolve, reject) => {
    database.ref('globos').once('value').then((snapshot) => {
      const globos = snapshot.val();
      resolve(globos);
    }).catch((error) => {
      reject(error);
    });
  });
}

// Función para mostrar modal de globos
async function mostrarModalGlobos() {
  try {
    const globos = await cargarGlobos();
    const modal = document.getElementById("modal-globos-1");
    const imagenesContainer = modal.querySelector(".globos-imagenes-1");
    const globosHelioSelect = document.getElementById("globos-helio");
    const cantidadPersonalizada = document.getElementById("cantidad-personalizada");

    // Determinar cantidad de globos
    let cantidadGlobos = globosHelioSelect.value === "personalizado" ? 
      parseInt(cantidadPersonalizada.value) : parseInt(globosHelioSelect.value);

    // Limpiar contenedor
    imagenesContainer.innerHTML = '';

    // Agregar globos al modal
    Object.keys(globos).forEach((key) => {
      const globo = globos[key];
      const img = document.createElement("img");
      img.src = globo.imagen;
      img.alt = globo.nombre;
      img.setAttribute("data-url", globo.imagen);
      img.setAttribute("data-precio", globo.precio);
      img.setAttribute("data-tipo", globo.tipo);

      // Verificar si este globo estaba seleccionado previamente
      const estabaSeleccionado = globosSeleccionados.some(g => g.url === globo.imagen);
      if (estabaSeleccionado) {
        img.classList.add("seleccionado");
      }

      imagenesContainer.appendChild(img);
    });

    modal.style.display = "block";

    // Configurar evento de clic para los globos
    const imagenes = imagenesContainer.querySelectorAll("img");
    imagenes.forEach(img => {
      img.addEventListener("click", function() {
        // Si solo se permite 1 globo, limpiar selecciones anteriores
        if (cantidadGlobos === 1) {
          imagenes.forEach(i => i.classList.remove("seleccionado"));
          globosSeleccionados = [];
        }

        // Manejar selección/deselección
        if (this.classList.contains("seleccionado")) {
          this.classList.remove("seleccionado");
          globosSeleccionados = globosSeleccionados.filter(g => g.url !== this.getAttribute("data-url"));
        } else if (globosSeleccionados.length < cantidadGlobos) {
          this.classList.add("seleccionado");
          globosSeleccionados.push({
            url: this.getAttribute("data-url"),
            tipo: this.getAttribute("data-tipo"),
            precio: parseInt(this.getAttribute("data-precio"))
          });
        }
      });
    });

    // Configurar botón de confirmación
    const seleccionarBtn = document.getElementById("seleccionar-globo");
    if (seleccionarBtn) {
      seleccionarBtn.onclick = function() {
        modal.style.display = "none";
        calcularTotalesCheckout(JSON.parse(localStorage.getItem("carritoCheckout") || localStorage.getItem("carrito")));
      };
    }

  } catch (error) {
    console.error("Error al cargar globos:", error);
    mostrarNotificacion("Error al cargar los colores de globos");
  }
}


// Modificar la función procesarPedido para incluir los nuevos campos
async function procesarPedido(e) {
  e.preventDefault();
  
  const o = document.getElementById("nombre").value;
  const t = document.getElementById("email").value;
  const n = document.getElementById("direccion").value;
  const fechaEntrega = document.getElementById("fecha-entrega").value;
  const puntoReferencia = document.getElementById("punto-referencia").value;
  const receptorNombre = document.getElementById("receptor-nombre").value;
  const receptorCelular = document.getElementById("receptor-celular").value;
  
  if (!o || !t || !n || !fechaEntrega || !receptorNombre || !receptorCelular) {
    return void mostrarNotificacion("Por favor completa todos los campos obligatorios");
  }
  
  const a = JSON.parse(localStorage.getItem("carritoCheckout") || localStorage.getItem("carrito"));
  const i = generarCodigoPedido();
  
  // Obtener la categoría del primer producto del carrito
  if (a && a.length > 0 && a[0].categoria) {
    categoriaProducto = a[0].categoria;
  }
  
  console.log("Comprobando Firebase...");
  
  if (!firebase.apps.length) {
    console.log("Inicializando Firebase...");
    const e = {
      apiKey: "AIzaSyC5QFujt2nmR40p6lXh3Yft7e7gxsvu7oY",
      authDomain: "morenitta-57ed3.firebaseapp.com",
      databaseURL: "https://morenitta-57ed3-default-rtdb.firebaseio.com",
      projectId: "morenitta-57ed3",
      storageBucket: "morenitta-57ed3.appspot.com",
      messagingSenderId: "813042769292",
      appId: "1:813042769292:web:e9bf4d9ba0eb80919ccaa9"
    };
    firebase.initializeApp(e);
  }
  
  const c = firebase.database();
  console.log("Firebase Database inicializada");
  
  generarResumenDescargable(i).then(async (e) => {
    console.log("Resumen generado correctamente");
    
    const r = (new Date).toISOString();
    const d = a.reduce(((e, o) => e + o.precio * o.cantidad), 0);
    const l = d > 0 ? 8000 : 0;
    
    let s = 0;
    const m = document.getElementById("globos-helio");
    const u = m && parseInt(m.value) || 0;
    
    // Calcular costo de globos
    const modal = document.getElementById("modal-globos-1");
    const globosSeleccionados = modal ? modal.querySelectorAll(".globos-imagenes-1 img.seleccionado") : [];
    
    let globosMetalizados = 0;
    let globosLatex = 0;
    let coloresGlobos = [];
    
    globosSeleccionados.forEach(globo => {
      if (globo.getAttribute("data-tipo") === "metalizado") {
        globosMetalizados++;
      } else {
        globosLatex++;
      }
      coloresGlobos.push(globo.getAttribute("data-url"));
    });
    
    if (u > 0) {
      s += (4500 * globosLatex) + (5000 * globosMetalizados);
    }
    
    const g = document.getElementById("mensaje-predefinido");
    if (g && "personalizado" === g.value) {
      s += 3000;
    }
    
    const p = d + l + s;
    const f = document.getElementById("motivo");
    
    let v = "No especificado";
    if (f) {
      switch (f.value) {
        case "feliz-cumpleanos":
          v = "Feliz cumpleaños";
          break;
        case "feliz-aniversario":
          v = "Feliz aniversario";
          break;
        case "feliz-mes":
          v = "Feliz mes";
          break;
        case "feliz-grado":
          v = "Feliz grado";
          break;
        case "te-amo":
          v = "Te amo";
          break;
        case "te-quiero":
          v = "Te quiero";
          break;
        case "felicidades":
          v = "Felicidades";
          break;
        case "bienvenido":
          v = "Bienvenido";
          break;
        default:
          v = "No especificado";
      }
    }
    
    let y = "Ninguno";
    const h = document.getElementById("mensaje-personalizado");
    
    if (g && "personalizado" === g.value && h) {
      y = `Personalizado: "${h.value}" `;
    } else if (g && g.value && "personalizado" !== g.value) {
      y = g.options[g.selectedIndex].text;
    }
    
    const b = document.querySelector(".globos-imagenes-1 img.seleccionado");
    const E = coloresGlobos.length > 0 ? coloresGlobos.join(", ") : "";
    
    // Obtener información del usuario activo
    let userInfo = {
      userId: 'invitado',
      userEmail: t,
      userDisplayName: o
    };
    
    try {
      const user = await new Promise((resolve) => {
        firebase.auth().onAuthStateChanged((user) => {
          resolve(user);
        });
      });
      
      if (user) {
        userInfo = {
          userId: user.uid,
          userEmail: user.email,
          userDisplayName: user.displayName || o
        };
      }
    } catch (error) {
      console.error("Error al verificar usuario:", error);
    }
    
    // Mapeo de métodos de pago
    const metodoPagoValue = document.getElementById("metodo-pago").value;
    let metodoPagoTexto = "";
    
    switch(metodoPagoValue) {
      case "efectivo":
        metodoPagoTexto = "Efectivo al recibir";
        break;
      case "bancolombia":
        metodoPagoTexto = "Bancolombia";
        break;
      case "nequi":
        metodoPagoTexto = "Nequi";
        break;
      case "daviplata":
        metodoPagoTexto = "Daviplata";
        break;
      case "wester":
        metodoPagoTexto = "Wester Union";
        break;
      default:
        metodoPagoTexto = "Método no especificado";
    }
    
    // Preparar datos del pedido con los nuevos campos
    const I = {
      id: i,
      fecha: r,
      fechaFormateada: new Date(r).toLocaleDateString(),
      fechaEntrega: fechaEntrega, // Nuevo campo
      categoria: categoriaProducto,
      cliente: {
        nombre: o,
        email: t,
        direccion: n,
        telefono: document.getElementById("telefono").value,
        puntoReferencia: puntoReferencia // Nuevo campo
      },
      receptor: { // Nuevos campos de receptor
        nombre: receptorNombre,
        celular: receptorCelular
      },
      usuario: userInfo,
      adicionales: {
        motivo: v,
        mensajeGloboPersonalizado: f && f.value === "personalizado" ? 
          document.getElementById("mensaje-personalizado-globo").value : "",
        globos: u > 0 ? `${u} globos (${globosLatex} látex + ${globosMetalizados} metalizados) - Total: $${(4500 * globosLatex) + (5000 * globosMetalizados)}` : "Ninguno",
        colorGlobo: E,
        mensaje: y,
        mensajePersonalizado: g && "personalizado" === g.value ? h.value : "",
        colorLazo: colorLazoSeleccionado ? { // Nuevo campo
          id: colorLazoSeleccionado.id,
          nombre: colorLazoSeleccionado.nombre,
          codigo: colorLazoSeleccionado.codigo
        } : null
      },
      productos: a,
      metodo_pago: metodoPagoTexto, // Método de pago actualizado
      subtotal: d,
      envio: l,
      adicionales_costo: s,
      total: p,
      estado: "Pendiente",
      timestamp: (new Date).getTime()
    };
    
    console.log("Datos del pedido preparados:", I);
    
    c.ref("pedidos").push(I).then((e) => {
      console.log("Pedido guardado con ID: ", e.key);
      document.getElementById("checkout-form").innerHTML = `
      <div class="procesando-pedido" style="text-align: center;">
        <h3>¡Pedido procesado correctamente!</h3>
        <p>Su código de pedido es: <strong>${i}</strong></p>
        <p>La factura se ha descargado en formato PNG</p>
        <div id="whatsapp-redirect-container" style="margin: 20px auto; display: inline-block;">
          <button id="go-to-whatsapp" style="padding: 12px 24px; background: #25D366; color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; margin: 0 auto;">
            redirigirse a WhatsApp para confirmar el pedido (obligatorio)
          </button>
        </div>
        <div id="back-to-home-container" style="display: none; margin-top: 20px;">
          <button id="back-to-home" style="padding: 12px 24px; background: #c5a8a3; color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer;">
            ← Volver al inicio
          </button>
        </div>
        <p style="margin-top: 20px; font-size: 14px; color: #666;">
          Si ya confirmaste tu pedido en WhatsApp, puedes volver al inicio
        </p>
      </div>
    `;
    
      localStorage.removeItem("carrito");
      localStorage.removeItem("carritoCheckout");
      localStorage.setItem("checkoutCompleto", "true");
    
      // Configurar el botón de WhatsApp
      document.getElementById("go-to-whatsapp").addEventListener("click", function() {
        const whatsappUrl = `https://wa.me/573023144445?text=${encodeURIComponent(`Hola, mi código de pedido es *${i}* y mi nombre es *${o}*.`)}`;
        window.open(whatsappUrl, "_blank");
        
        // Mostrar el botón de volver al inicio después de ir a WhatsApp
        document.getElementById("back-to-home-container").style.display = "block";
      });
    
      // Configurar el botón de volver al inicio
      document.getElementById("back-to-home").addEventListener("click", function() {
        window.location.href = "index.html";
      });
    
      // Mostrar el botón de volver al inicio si detectamos que viene de WhatsApp
      if (document.referrer.includes("whatsapp.com") || document.referrer.includes("wa.me")) {
        document.getElementById("back-to-home-container").style.display = "block";
      }
    
    }).catch((e) => {
      console.error("Error al guardar el pedido: ", e);
      mostrarNotificacion("Hubo un error al procesar su pedido: " + e.message);
    });
  }).catch((e) => {
    console.error("Error al generar resumen:", e);
    mostrarNotificacion("Error al generar el resumen del pedido");
  });
}
// Modificar la función generarResumenDescargable para excluir la fecha del resumen imprimible
// Modificar la función generarResumenDescargable para excluir la fecha del resumen imprimible
function generarResumenDescargable(e) {
  return new Promise((o, t) => {
    const n = document.getElementById("nombre").value || "No especificado";
    const a = document.getElementById("email").value || "No especificado";
    const i = document.getElementById("telefono").value || "No especificado";
    const c = document.getElementById("direccion").value || "No especificado";
    const puntoReferencia = document.getElementById("punto-referencia").value || "No especificado";
    const receptorNombre = document.getElementById("receptor-nombre").value || "No especificado";
    const receptorCelular = document.getElementById("receptor-celular").value || "No especificado";
    const r = document.getElementById("metodo-pago").value;
    const d = document.getElementById("motivo");
    const l = document.getElementById("globos-helio").value;
    const s = document.getElementById("mensaje-predefinido");
    const m = document.getElementById("mensaje-personalizado").value;
    const u = document.querySelectorAll(".globos-imagenes-1 img.seleccionado");
    
    const p = localStorage.getItem("carritoCheckout") || localStorage.getItem("carrito");
    const f = JSON.parse(p);
    const v = f.reduce(((e, o) => e + o.precio * o.cantidad), 0);
    const y = v > 0 ? 8000 : 0;
    
    let h = 0;
    const b = parseInt(l) || 0;
    
    // Calcular costo de globos
    let globosMetalizados = 0;
    let globosLatex = 0;
    let coloresGlobos = [];
    
    u.forEach(globo => {
      if (globo.getAttribute("data-tipo") === "metalizado") {
        globosMetalizados++;
      } else {
        globosLatex++;
      }
      coloresGlobos.push(globo.getAttribute("data-url"));
    });
    
    if (b > 0) {
      h += (4500 * globosLatex) + (5000 * globosMetalizados);
    }
    
    if (s && "personalizado" === s.value) {
      h += 3000;
    }
    
    const E = v + y + h;
    
    let I = "Ninguno";
    if (s && "personalizado" === s.value && m) {
      I = `Personalizado: "${m}" `;
    } else if (s && s.value && "personalizado" !== s.value) {
      I = s.options[s.selectedIndex].text;
    }
    
    let k = "Ninguno";
    if (b > 0) {
      k = `${b} globos (${globosLatex} colores ) - Total: $${(4500 * globosLatex) + (5000 * globosMetalizados)}`;
      if (coloresGlobos.length > 0) {
        k += ` (Colores seleccionados)`;
      }
    }
    
    let $ = "No especificado";
    if (d) {
      switch (d.value) {
        case "feliz-cumpleanos":
          $ = "Feliz cumpleaños";
          break;
        case "feliz-aniversario":
          $ = "Feliz aniversario";
          break;
        case "feliz-mes":
          $ = "Feliz mes";
          break;
        case "feliz-grado":
          $ = "Feliz grado";
          break;
        case "te-amo":
          $ = "Te amo";
          break;
        case "te-quiero":
          $ = "Te quiero";
          break;
        case "felicidades":
          $ = "Felicidades";
          break;
        case "bienvenido":
          $ = "Bienvenido";
          break;
        default:
          $ = "No especificado";
      }
    }
    
    // Mapeo de métodos de pago para el resumen
    let metodoPagoTexto = "";
    switch(r) {
      case "efectivo":
        metodoPagoTexto = "Efectivo al recibir";
        break;
      case "bancolombia":
        metodoPagoTexto = "Bancolombia";
        break;
      case "nequi":
        metodoPagoTexto = "Nequi";
        break;
      case "daviplata":
        metodoPagoTexto = "Daviplata";
        break;
      case "wester":
        metodoPagoTexto = "Wester Union";
        break;
      default:
        metodoPagoTexto = "Método no especificado";
    }
    
    const S = document.getElementById("resumen-items-print");
    const B = document.getElementById("resumen-totales-print");
    const C = document.getElementById("resumen-cliente-print");
    const x = document.getElementById("resumen-adicionales-print");
    
    let L = "";
    f.forEach((e, index) => {
      L += `
        <div style="display: flex; align-items: center; margin-bottom: 18px; border-bottom: 1px solid #e8e8e8; padding-bottom: 18px; background: linear-gradient(90deg, #fafafa 0%, #ffffff 100%); border-radius: 8px; padding: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
          <div style="width: 42px; height: 42px; border-radius: 50%; background: linear-gradient(135deg, #c5a8a3 0%, #b89890 100%); color: white; display: flex; align-items: center; justify-content: center; margin-right: 16px; font-weight: bold; font-size: 16px; box-shadow: 0 3px 8px rgba(197,168,163,0.3);">
            ${index + 1}
          </div>
          <div style="flex: 1;">
            <div style="font-weight: 600; color: #2d3748; font-size: 15px; margin-bottom: 4px;">${e.nombre}</div>
            <div style="color: #718096; font-size: 13px; font-weight: 500;">${e.precio.toLocaleString()} × ${e.cantidad}</div>
          </div>
          <div style="font-weight: 700; color: #c5a8a3; font-size: 16px; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">${(e.precio * e.cantidad).toLocaleString()}</div>
        </div>
      `;
    });
    
    S.innerHTML = L;
    
    B.innerHTML = `
      <div style="margin-top: 25px; border-top: 2px solid #e2e8f0; padding-top: 20px; background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%); border-radius: 12px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
        <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-weight: 500; color: #4a5568;">
          <span>Subtotal:</span>
          <span>${v.toLocaleString()}</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-weight: 500; color: #4a5568;">
          <span>Envío:</span>
          <span>${y.toLocaleString()}</span>
        </div>
        ${h > 0 ? `
        <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-weight: 500; color: #4a5568;">
          <span>Adicionales:</span>
          <span>${h.toLocaleString()}</span>
        </div>
        ` : ""}
        <div style="border-top: 2px solid #c5a8a3; margin-top: 15px; padding-top: 15px;">
          <div style="display: flex; justify-content: space-between; font-size: 20px; font-weight: 800; color: #c5a8a3; text-shadow: 0 2px 4px rgba(0,0,0,0.1); background: linear-gradient(90deg, #c5a8a3, #b89890); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
            <span style="color: #2C2C2C">TOTAL:</span>
            <span style="color: #2C2C2C">${E.toLocaleString()}</span>
          </div>
        </div>
      </div>
    `;
    
    C.innerHTML = `
      <div style="margin-top: 25px; border-top: 2px solid #e2e8f0; padding-top: 20px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 12px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
        <h3 style="margin-bottom: 18px; color: #2d3748; font-weight: 700; font-size: 18px; text-align: center; text-shadow: 0 1px 3px rgba(0,0,0,0.1);">📦 DATOS DE ENVÍO</h3>
        <div style="display: flex; justify-content: space-between; margin-bottom: 10px; padding: 8px 12px; background: rgba(255,255,255,0.7); border-radius: 6px; border-left: 4px solid #c5a8a3;">
          <span style="font-weight: 600; color: #4a5568;">Código:</span>
          <span style="font-weight: 500; color: #2d3748;">${e}</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 10px; padding: 8px 12px; background: rgba(255,255,255,0.7); border-radius: 6px; border-left: 4px solid #c5a8a3;">
          <span style="font-weight: 600; color: #4a5568;">Nombre:</span>
          <span style="font-weight: 500; color: #2d3748;">${n}</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 10px; padding: 8px 12px; background: rgba(255,255,255,0.7); border-radius: 6px; border-left: 4px solid #c5a8a3;">
          <span style="font-weight: 600; color: #4a5568;">Email:</span>
          <span style="font-weight: 500; color: #2d3748;">${a}</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 10px; padding: 8px 12px; background: rgba(255,255,255,0.7); border-radius: 6px; border-left: 4px solid #c5a8a3;">
          <span style="font-weight: 600; color: #4a5568;">Teléfono:</span>
          <span style="font-weight: 500; color: #2d3748;">${i}</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 10px; padding: 8px 12px; background: rgba(255,255,255,0.7); border-radius: 6px; border-left: 4px solid #c5a8a3;">
          <span style="font-weight: 600; color: #4a5568;">Dirección:</span>
          <span style="font-weight: 500; color: #2d3748;">${c}</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 10px; padding: 8px 12px; background: rgba(255,255,255,0.7); border-radius: 6px; border-left: 4px solid #c5a8a3;">
          <span style="font-weight: 600; color: #4a5568;">Punto de referencia:</span>
          <span style="font-weight: 500; color: #2d3748;">${puntoReferencia}</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 10px; padding: 8px 12px; background: rgba(255,255,255,0.7); border-radius: 6px; border-left: 4px solid #c5a8a3;">
          <span style="font-weight: 600; color: #4a5568;">Quién recibe:</span>
          <span style="font-weight: 500; color: #2d3748;">${receptorNombre}</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 10px; padding: 8px 12px; background: rgba(255,255,255,0.7); border-radius: 6px; border-left: 4px solid #c5a8a3;">
          <span style="font-weight: 600; color: #4a5568;">Celular receptor:</span>
          <span style="font-weight: 500; color: #2d3748;">${receptorCelular}</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 10px; padding: 8px 12px; background: rgba(255,255,255,0.7); border-radius: 6px; border-left: 4px solid #c5a8a3;">
          <span style="font-weight: 600; color: #4a5568;">Método de pago:</span>
          <span style="font-weight: 500; color: #2d3748;">${metodoPagoTexto}</span>
        </div>
      </div>
    `;
    
    x.innerHTML = `
      <div style="margin-top: 20px; border-top: 1px solid #eee; padding-top: 15px;">
        <h3 style="margin-bottom: 10px; text-align: center">Gracias por su compra</h3>
        <div style="margin-top: 20px; text-align: center; font-size: 12px; color: #999;">
          <p>Fecha del pedido: ${(new Date).toLocaleDateString()}</p>
        </div>
      </div>
    `;
    
    const N = document.getElementById("resumen-para-imprimir");
    N.style.display = "block";
    
    html2canvas(N, {
      backgroundColor: "#ffffff",
      scale: 2,
      logging: false,
      useCORS: true
    }).then((e) => {
      N.style.display = "none";
      const t = e.toDataURL("image/png");
      const n = document.createElement("a");
      n.href = t;
      n.download = "resumen-pedido.png";
      document.body.appendChild(n);
      n.click();
      document.body.removeChild(n);
      mostrarNotificacion("El resumen se ha descargado correctamente");
      o(t);
    }).catch((e) => {
      console.error("Error al generar la imagen:", e);
      mostrarNotificacion("Hubo un error al generar la imagen del resumen");
      t(e);
    });
  });
}
// [El código anterior continúa...]

function generarCodigoPedido() {
  return Math.floor(100000 + 900000 * Math.random()).toString();
}

function mostrarNotificacion(e) {
  const o = document.getElementById("toastNotification");
  
  if (o) {
    o.textContent = e;
    o.style.display = "block";
    setTimeout(() => {
      o.style.display = "none";
    }, 3000);
  } else {
    const o = document.createElement("div");
    o.className = "toast-notification";
    o.textContent = e;
    document.body.appendChild(o);
    setTimeout(() => {
      document.body.removeChild(o);
    }, 3000);
  }
}

// Event listeners
document.getElementById("ver-colores-globos").addEventListener("click", function() {
  const globosHelioSelect = document.getElementById("globos-helio");
  if (globosHelioSelect.value === "0") {
    globosSeleccionados = [];
  }
  mostrarModalGlobos();
});

document.addEventListener("DOMContentLoaded", function() {
  const e = localStorage.getItem("carritoCheckout") || localStorage.getItem("carrito");
  
  if (e && "[]" !== e) {
    const o = JSON.parse(e);
    mostrarProductosCheckout(o);
    calcularTotalesCheckout(o);
  } else {
    document.getElementById("checkout-items").innerHTML = `
      <div class="carrito-vacio">
        <i>🛒</i>
        <p>El carrito está vacío</p>
        <p><a href="index.html">Volver a la tienda</a></p>
      </div>
    `;
    document.getElementById("checkout-total").style.display = "none";
    document.getElementById("checkout-form").style.display = "none";
  }
  
  const o = document.getElementById("checkout-form");
  o && o.addEventListener("submit", procesarPedido);
  const t = document.getElementById("globos");
  t && t.addEventListener("change", function() {
    calcularTotalesCheckout(JSON.parse(e));
  });
  
  const n = document.getElementById("agregar-adicion");
  n && n.addEventListener("click", function() {
    abrirModalAdiciones();
  });
  
  const a = document.getElementById("close-modal");
  a && a.addEventListener("click", cerrarModalAdiciones);
  
  const i = document.getElementById("adicion-modal");
  i && i.addEventListener("click", function(e) {
    e.target === i && cerrarModalAdiciones();
  });
});

document.addEventListener("DOMContentLoaded", function() {
  mostrarProductosCheckout(JSON.parse(localStorage.getItem("carritoCheckout") || localStorage.getItem("carrito") || "[]"));
  
  const e = document.getElementById("eliminar-adiciones");
  e && e.addEventListener("click", function() {
    eliminarTodasAdiciones();
  });
});

document.addEventListener("DOMContentLoaded", function() {
  const e = document.getElementById("globos-helio");
  const o = document.getElementById("ver-colores-globos");
  const t = document.getElementById("modal-globos-1");
  const n = t.querySelector(".close-1");
  
  e && o && e.addEventListener("change", function() {
    this.value > 0 ? o.style.display = "block" : o.style.display = "none";
  });
  
  o && t && o.addEventListener("click", function() {
    mostrarModalGlobos();
  });
  
  n && n.addEventListener("click", function() {
    t.style.display = "none";
  });
  
  window.addEventListener("click", function(e) {
    e.target === t && (t.style.display = "none");
  });
});

document.addEventListener("DOMContentLoaded", function() {
  // Para el mensaje personalizado de globo
  const motivoSelect = document.getElementById("motivo");
  const mensajeGloboContainer = document.getElementById("mensaje-personalizado-globo-container");
  
  motivoSelect && mensajeGloboContainer && motivoSelect.addEventListener("change", function() {
    if (this.value === "personalizado") {
      mensajeGloboContainer.style.display = "block";
    } else {
      mensajeGloboContainer.style.display = "none";
    }
    calcularTotalesCheckout(JSON.parse(localStorage.getItem("carritoCheckout") || localStorage.getItem("carrito")));
  });
  
  // Para el mensaje personalizado de tarjeta (existente)
  const e = document.getElementById("mensaje-predefinido");
  const o = document.getElementById("mensaje-personalizado-container");
  
  e && o && e.addEventListener("change", function() {
    "personalizado" === this.value ? o.style.display = "block" : o.style.display = "none";
    calcularTotalesCheckout(JSON.parse(localStorage.getItem("carritoCheckout") || localStorage.getItem("carrito")));
  });
  
  const t = document.getElementById("globos-helio");
  t && t.addEventListener("change", function() {
    calcularTotalesCheckout(JSON.parse(localStorage.getItem("carritoCheckout") || localStorage.getItem("carrito")));
  });
});

document.addEventListener("DOMContentLoaded", function() {
  // Para el select de globos
  const globosHelioSelect = document.getElementById("globos-helio");
  const cantidadPersonalizadaContainer = document.getElementById("cantidad-personalizada-container");
  const cantidadPersonalizadaInput = document.getElementById("cantidad-personalizada");
  
  globosHelioSelect.addEventListener("change", function() {
    if (this.value === "personalizado") {
      cantidadPersonalizadaContainer.style.display = "block";
      cantidadPersonalizadaInput.value = "1";
    } else {
      cantidadPersonalizadaContainer.style.display = "none";
    }
    
    // Mostrar/ocultar botón de selección de colores
    const verColoresBtn = document.getElementById("ver-colores-globos");
    if (this.value > 0 || this.value === "personalizado") {
      verColoresBtn.style.display = "block";
    } else {
      verColoresBtn.style.display = "none";
    }
    
    calcularTotalesCheckout(JSON.parse(localStorage.getItem("carritoCheckout") || localStorage.getItem("carrito")));
  });
  
  cantidadPersonalizadaInput.addEventListener("change", function() {
    calcularTotalesCheckout(JSON.parse(localStorage.getItem("carritoCheckout") || localStorage.getItem("carrito")));
  });
});


</script>